[
    {
        "Query": "Lấy danh sách mã chứng khoán có doanh thu hoạt động môi giới chứng khoán lớn hơn 10000 trong quý 1 năm 2023.",
        "SQL": "SELECT code FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 1 AND nam = 2023 AND doanhthuhoatdongmoigioick > 10000",
        "Type": "where",
        "gen_SQL": "SELECT t.code FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.doanhthuhoatdongmoigioick > 10000 AND t.quy = 1 AND t.nam = 2023 ORDER BY t.code NULLS LAST;",
        "correction_gen_SQL": true,
        "correction_SQL": true
    },
    {
        "Query": "Tổng doanh thu hoạt động môi giới chứng khoán theo từng quý trong năm 2023.", 
        "SQL": "SELECT quy, SUM(doanhthuhoatdongmoigioick) as tongDoanhThu FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE nam = 2023 GROUP BY quy",
        "Type": "group_by",
        "gen_SQL": "SELECT t.quy, SUM(t.doanhthuhoatdong) AS total_revenue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.nam = 2023 GROUP BY t.quy ORDER BY t.quy NULLS LAST;",
        "correction_gen_SQL": false,
        "correction_SQL": false // chưa tự động biết select cho từng mã khi query chưa có đủ thông tin
    },
    {
        "Query": "Liệt kê mã chứng khoán và doanh thu hoạt động môi giới chứng khoán từ cao đến thấp trong quý 2 năm 2023.",
        "SQL": "SELECT code, doanhthuhoatdongmoigioick FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 2 AND nam = 2023 ORDER BY doanhthuhoatdongmoigioick DESC",
        "Type": "order_by",
        "gen_SQL": "SELECT t.code, t.doanhthuhoatdongmoigioick FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.quy = 2 AND t.nam = 2023 ORDER BY t.doanhthuhoatdongmoigioick DESC NULLS LAST;",
        "correction_gen_SQL": true,
        "correction_SQL": true
    },
    {
        "Query": "Tìm mã chứng khoán có doanh thu hoạt động môi giới chứng khoán tăng cao nhất từ quý 1 đến quý 2 năm 2023.",
        "SQL": "WITH Q1 AS (SELECT code, doanhthuhoatdongmoigioick as Q1Revenue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 1 AND nam = 2023), Q2 AS (SELECT code, doanhthuhoatdongmoigioick as Q2Revenue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 2 AND nam = 2023) SELECT Q1.code FROM Q1 JOIN Q2 ON Q1.code = Q2.code ORDER BY Q2.Q2Revenue - Q1.Q1Revenue DESC LIMIT 1",
        "Type": "date",
        "gen_SQL": "SELECT t.code, t.doanhthuhoatdongmoigioick FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.nam = 2023 AND t.quy BETWEEN 1 AND 2 ORDER BY t.doanhthuhoatdongmoigioick DESC NULLS LAST LIMIT 1;",
        "correction_gen_SQL": false,
        "correction_SQL": true
    },
    {
        "Query": "Tính tỷ lệ doanh thu hoạt động môi giới chứng khoán trên tổng doanh thu của mỗi mã chứng khoán trong quý 4 năm 2023.",
        "SQL": "SELECT code, (doanhthuhoatdongmoigioick / SUM(doanhthuhoatdongmoigioick) OVER()) * 100 as tyLe FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 4 AND nam = 2023",
        "Type": "ratio",
        "gen_SQL": "SELECT t.code, SUM(t.doanhthuhoatdongmoigioick)::FLOAT / NULLIF(SUM(t.doanhthuhoatdong), 0) AS ratio FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.quy = 4 AND t.nam = 2023 GROUP BY t.code ORDER BY ratio NULLS LAST;",
        "correction_gen_SQL": false,
        "correction_SQL": false
    },
    {
        "Query": "Liệt kê mã chứng khoán có lợi nhuận sau thuế dương trong quý 3 năm 2023.",
        "SQL": "SELECT code FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 3 AND nam = 2023 AND lnsauthue > 0",
        "Type": "where",
        "gen_SQL": "SELECT t.code, t.lnsauthue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.quy IN (3, 4, 5) AND t.nam = 2023 ORDER BY t.lnsauthue DESC NULLS LAST;",
        "correction_gen_SQL": false,
        "correction_SQL": true
    },
    {
        "Query": "Tính tổng lợi nhuận sau thuế theo từng năm.",
        "SQL": "SELECT nam, SUM(lnsauthue) as tongLai FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly GROUP BY nam",
        "Type": "group_by",
        "gen_SQL": "SELECT t.nam, SUM(t.lnsauthue) AS total_profit FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t GROUP BY t.nam ORDER BY t.nam;",
        "correction_gen_SQL": false,
        "correction_SQL": false // chưa tự động biết select cho từng mã khi query chưa có đủ thông tin
        
    },
    {
        "Query": "Liệt kê top 3 mã chứng khoán có lợi nhuận sau thuế cao nhất trong năm 2023.",
        "SQL": "SELECT code, lnsauthue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE nam = 2023 ORDER BY lnsauthue DESC LIMIT 3",
        "Type": "order_by",
        "gen_SQL": "SELECT t.code, t.lnsauthue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.nam = 2023 ORDER BY t.lnsauthue DESC NULLS LAST LIMIT 3;",
        "correction_gen_SQL": true,
        "correction_SQL": true
    },
    {
        "Query": "Tìm mã chứng khoán có doanh thu từ tư vấn đầu tư chứng khoán tăng cao nhất từ quý 3 đến quý 4 năm 2023.",
        "SQL": "WITH Q3 AS (SELECT code, doanhthutuvandautuck as Q3Revenue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 3 AND nam = 2023), Q4 AS (SELECT code, doanhthutuvandautuck as Q4Revenue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 4 AND nam = 2023) SELECT Q3.code FROM Q3 JOIN Q4 ON Q3.code = Q4.code ORDER BY Q4.Q4Revenue - Q3.Q3Revenue DESC LIMIT 1",
        "Type": "date",
        "gen_SQL": "SELECT t.code, t.doanhthuhoatdong FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.nam = 2023 AND t.quy BETWEEN 3 AND 4 AND t.doanhthuhoatdong > (SELECT MAX(doanhthuhoatdong) FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE nam = 2023 AND quy BETWEEN 3 AND 4) ORDER BY t.doanhthuhoatdong DESC NULLS LAST LIMIT 1;",
        "correction_gen_SQL": false,
        "correction_SQL": true
    },
    {
        "Query": "Tính tỷ lệ lợi nhuận sau thuế trên tổng doanh thu cho mỗi mã chứng khoan trong năm 2023.",
        "SQL": "SELECT code, (lnsauthue / SUM(lnsauthue) OVER()) * 100 as tyLeLai FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE nam = 2023",
        "Type": "ratio",
        "gen_SQL": "SELECT t.code, SUM(t.lnsauthue) / NULLIF(SUM(t.tongthunhaptoandien), 0) AS ratio FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.nam = 2023 GROUP BY t.code ORDER BY ratio NULLS LAST;",
        "correction_gen_SQL": false,
        "correction_SQL": false
    },
    {
        "Query": "Liệt kê mã chứng khoán có chi phí hoạt động dưới 5000 trong quý 4 năm 2023.",
        "SQL": "SELECT code FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 4 AND nam = 2023 AND cphoatdong < 5000",
        "Type": "where",
        "gen_SQL": "SELECT t.code FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.quy = 4 AND t.nam = 2023 AND t.cphoatdong < 5000 ORDER BY t.code NULLS LAST;"
    },
    {
        "Query": "Tính tổng chi phí hoạt động theo từng quý trong năm 2023.",
        "SQL": "SELECT quy, SUM(cphoatdong) as tongChiPhi FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE nam = 2023 GROUP BY quy",
        "Type": "group_by",
        "gen_SQL": "SELECT t.quy, SUM(t.cphoatdong) AS total_cost FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.nam = 2023 GROUP BY t.quy ORDER BY t.quy NULLS LAST;",
        "correction_gen_SQL": false,
        "correction_SQL": false // chưa tự động biết select cho từng mã khi query chưa có đủ thông tin
    },
    {
        "Query": "Liệt kê 5 mã chứng khoán có chi phí hoạt động thấp nhất trong năm 2023.",
        "SQL": "SELECT code, cphoatdong FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE nam = 2023 ORDER BY cphoatdong ASC LIMIT 5",
        "Type": "order_by",
        "gen_SQL": "SELECT t.code, t.cphoatdong FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.nam = 2023 ORDER BY t.cphoatdong ASC NULLS LAST LIMIT 5;"
    },
    {
        "Query": "Tìm mã chứng khoán có sự tăng trưởng doanh thu từ hoạt động bảo lãnh, đại lý phát hành chứng khoán từ quý 2 đến quý 3 năm 2023.",
        "SQL": "WITH Q2 AS (SELECT code, doanhthubaolanhdailyphathanhck as Q2Revenue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 2 AND nam = 2023), Q3 AS (SELECT code, doanhthubaolanhdailyphathanhck as Q3Revenue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 3 AND nam = 2023) SELECT Q2.code FROM Q2 JOIN Q3 ON Q2.code = Q3.code ORDER BY Q3.Q3Revenue - Q2.Q2Revenue DESC LIMIT 1",
        "Type": "date",
        "gen_SQL": "SELECT t.code, t.doanhthuhoatdong - LAG(t.doanhthuhoatdong, 1) OVER (PARTITION BY t.code ORDER BY t.quy, t.nam) AS percentage_change FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.nam = 2023 AND t.quy BETWEEN 2 AND 3 ORDER BY t.code, t.quy, t.nam NULLS LAST;",
        "correction_gen_SQL": false, // tốt hơn tuy nhiên lại dùng between
        "correction_SQL": true
    },
    {
        "Query": "Tính tỷ lệ chi phí hoạt động trên tổng chi phí hoạt động của tất cả các mã chứng khoán trong quý 1 năm 2023.",
        "SQL": "SELECT code, (cphoatdong / SUM(cphoatdong) OVER()) * 100 as tyLeChiPhi FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 1 AND nam = 2023",
        "Type": "ratio",
        "gen_SQL": "SELECT SUM(t.cphoatdong)::FLOAT / NULLIF(SUM(t.doanhthuhoatdong), 0) AS cost_to_revenue_ratio FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.quy = 1 AND t.nam = 2023;",
        "correction_gen_SQL": false, 
        "correction_SQL": false // chưa hiểu rõ data
    },
    {
        "Query": "Liệt kê mã chứng khoán với doanh thu hoạt động tài chính lớn hơn 20000 trong quý 1 năm 2023.",
        "SQL": "SELECT code FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 1 AND nam = 2023 AND doanhthuhoatdongtc > 20000",
        "Type": "where",
        "gen_SQL": "SELECT t.code FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.quy = 1 AND t.nam = 2023 AND t.doanhthuhoatdong > 20000 ORDER BY t.code NULLS LAST;"
    },
    {
        "Query": "Tổng doanh thu hoạt động tài chính theo từng năm.",
        "SQL": "SELECT nam, SUM(doanhthuhoatdongtc) as tongDoanhThuTaiChinh FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly GROUP BY nam",
        "Type": "group_by",
        "gen_SQL": "SELECT t.nam, SUM(t.doanhthuhoatdong) AS total_revenue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t GROUP BY t.nam ORDER BY t.nam;",
        "correction_gen_SQL": false,
        "correction_SQL": false // chưa tự động biết select cho từng mã khi query chưa có đủ thông tin
    },
    {
        "Query": "Liệt kê top 4 mã chứng khoán có doanh thu hoạt động tài chính cao nhất trong quý 3 năm 2023.",
        "SQL": "SELECT code, doanhthuhoatdongtc FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 3 AND nam = 2023 ORDER BY doanhthuhoatdongtc DESC LIMIT 4",
        "Type": "order_by",
        "gen_SQL": "SELECT t.code, t.doanhthuhoatdong FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.quy IN (3, 10, 11, 12) AND t.nam = 2023 ORDER BY t.doanhthuhoatdong DESC NULLS LAST LIMIT 4;",
        "correction_gen_SQL": false,
        "correction_SQL": true
    },
    {
        "Query": "Tìm mã chứng khoán có doanh thu từ hoạt động tư vấn tài chính tăng cao nhất từ quý 4 năm 2022 đến quý 1 năm 2023.",
        "SQL": "WITH Q4_2022 AS (SELECT code, doanhthuhoatdongtuvantc as Q4_2022Revenue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 4 AND nam = 2022), Q1_2023 AS (SELECT code, doanhthuhoatdongtuvantc as Q1_2023Revenue FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE quy = 1 AND nam = 2023) SELECT Q4_2022.code FROM Q4_2022 JOIN Q1_2023 ON Q4_2022.code = Q1_2023.code ORDER BY Q1_2023.Q1_2023Revenue - Q4_2022.Q4_2022Revenue DESC LIMIT 1",
        "Type": "date",
        "gen_SQL": "SELECT t.code, t.doanhthuhoatdong FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.quy BETWEEN 4 AND 1 AND t.nam BETWEEN 2022 AND 2023 ORDER BY t.doanhthuhoatdong DESC NULLS LAST LIMIT 1;",
        "correction_gen_SQL": false,
        "correction_SQL": true
    },
    {
        "Query": "Tính tỷ lệ doanh thu từ hoạt động tư vấn tài chính trên tổng doanh thu từ tất cả hoạt động trong năm 2023.",
        "SQL": "SELECT code, (doanhthuhoatdongtuvantc / SUM(doanhthuhoatdongtuvantc) OVER()) * 100 as tyLeDoanhThuTuVanTaiChinh FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly WHERE nam = 2023",
        "Type": "ratio",
        "gen_SQL": "SELECT SUM(CASE WHEN t.doanhthutuvantc IS NOT NULL THEN t.doanhthutuvantc ELSE 0 END)::FLOAT / NULLIF(SUM(t.doanhthuhoatdong), 0) AS proportion FROM fact_period_bctc_ket_qua_kinh_doanh_chung_khoan_quarterly t WHERE t.nam = 2023;",
        "correction_gen_SQL": false, // give wrong field
        "correction_SQL": false
    }
]